<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Free Digital AUS TV Stations</title>
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="css/listview-grid.css">
    <script src="js/jquery-1.12.4.js"></script>
    <script src="js/jquery.mobile-1.4.5.js"></script>
</head>
<body>

<div data-role="page" data-theme="b" id="demo-page" class="my-page">

    <div data-role="header">
        <h1>Free Digital TV Stations</h1>
    </div>

    <div role="main" class="ui-content">
        <a href="https://chrome.google.com/webstore/detail/native-hls-playback/emnphkkblegpebimobpbekeedfgemhof" data-role="button">
            Direct Playback Chrome extension <click to install>
        </a>
        <p>Date/Time: <span id="datetime"></span>
        <script>
            var dt = new Date();
            document.getElementById("datetime").innerHTML = dt.toLocaleString();
        </script></p>

        <ul id="channel-list" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Search...">
            <!-- Channel items will be added here dynamically -->
        </ul><!-- /listview -->
    </div><!-- /content -->

</div><!-- /page -->

<script>
    $(document).ready(function() {
        $.ajax({
            url: 'https://i.mjh.nz/au/Sydney/raw-tv.m3u8',
            success: function(data) {
                var lines = data.split('\n');
                var channels = [];
                var currentChannel = {};

                lines.forEach(function(line) {
                    if (line.startsWith('#EXTINF')) {
                        var info = line.split(',');
                        currentChannel.name = info[1].trim();
                        var tvgLogoMatch = line.match(/tvg-logo="([^"]+)"/);
                        if (tvgLogoMatch) {
                            currentChannel.logo = tvgLogoMatch[1];
                        }
                    } else if (line.startsWith('http') && currentChannel.name) {
                        currentChannel.url = line.trim();
                        channels.push(currentChannel);
                        currentChannel = {};
                    }
                });

                var list = $('#channel-list');
                channels.forEach(function(channel) {
                    console.log('Channel:', channel.name);
                    console.log('Image URL:', channel.logo);
                    console.log('Stream URL:', channel.url);

                    var listItem = `
                        <li>
                            <a target="_blank" href="${channel.url}">
                                <img src="${channel.logo}" class="ui-li-thumb">
                                <h2>${channel.name}</h2>
                                <p class="ui-li-aside">TV</p>
                            </a>
                        </li>
                    `;
                    list.append(listItem);
                });
                list.listview('refresh');
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error('Error loading m3u8 file:', textStatus, errorThrown);
            }
        });
    });
</script>

</body>
</html>
